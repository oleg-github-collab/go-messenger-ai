# ‚úÖ –°–∏—Å—Ç–µ–º–∞ –ì—ñ–±–µ—Ä–Ω–∞—Ü—ñ—ó –ü–æ–≤–Ω—ñ—Å—Ç—é –ü—Ä–∞—Ü—é—î!

## üéâ –ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ - –í—Å–µ –ü—Ä–∞—Ü—é—î –Ü–¥–µ–∞–ª—å–Ω–æ!

### –ü–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ (–∑–∞—Ä–∞–∑):

‚úÖ **Railway Proxy** - –ü—Ä–∞—Ü—é—î
- URL: https://messenger.kaminskyi.chat
- –ü—Ä–æ–∫—Å—ñ—é—î –∑–∞–ø–∏—Ç–∏ —á–µ—Ä–µ–∑ HTTPS (port 443)
- Health check: ‚úÖ –ü–æ–≤–µ—Ä—Ç–∞—î –ø—Ä–∞–≤–∏–ª—å–Ω—ñ –¥–∞–Ω—ñ
- Landing page: ‚úÖ –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è

‚úÖ **Health Endpoint** - –ü—Ä–∞—Ü—é—î
```json
{
  "redis": true,
  "sfu": true,
  "status": "ready",
  "timestamp": 1759885246,
  "uptime": 21557 —Å–µ–∫—É–Ω–¥ (5.9 –≥–æ–¥–∏–Ω)
}
```

‚úÖ **Sleep Controller** - –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ —Ç–∞ –ó–∞–ø—É—â–µ–Ω–æ
- –°–ª—É–∂–±a: `sleep-controller.service`
- –°—Ç–∞—Ç—É—Å: `active (running)`
- Auto-start: ‚úÖ Enabled

‚úÖ **Messenger Droplet** - –ê–∫—Ç–∏–≤–Ω–∏–π
- IP: 64.227.116.250
- Uptime: 5.9 –≥–æ–¥–∏–Ω
- –°–µ—Ä–≤—ñ—Å–∏: Redis ‚úÖ, SFU ‚úÖ, Messenger ‚úÖ

## üîß –©–æ –ë—É–ª–æ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ

### –ü—Ä–æ–±–ª–µ–º–∞:
- Railway proxy –ø–æ–∫–∞–∑—É–≤–∞–≤ –±–µ–∑–∫—ñ–Ω–µ—á–Ω–∏–π —Ç–∞–π–º–µ—Ä –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
- –ó–∞–ø–∏—Ç–∏ –Ω–µ –ø—Ä–æ–∫—Å—ñ—é–≤–∞–ª–∏—Å—å –¥–æ –¥—Ä–æ–ø–ª–µ—Ç–∞
- Health check –±–ª–æ–∫—É–≤–∞–≤ –ø—Ä–æ–∫—Å—ñ—é–≤–∞–Ω–Ω—è

### –†—ñ—à–µ–Ω–Ω—è:
1. ‚úÖ –ó–º—ñ–Ω–µ–Ω–æ –∑ HTTP –Ω–∞ HTTPS (port 443)
2. ‚úÖ –î–æ–¥–∞–Ω–æ –ø—ñ–¥—Ç—Ä–∏–º–∫—É self-signed SSL —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—ñ–≤
3. ‚úÖ –í–∏–¥–∞–ª–µ–Ω–æ –±–ª–æ–∫—É—é—á–∏–π health check
4. ‚úÖ Proxy —Ç–µ–ø–µ—Ä –ø—Ä–æ–∫—Å—ñ—é—î –≤—ñ–¥—Ä–∞–∑—É –∫–æ–ª–∏ droplet active
5. ‚úÖ Health check —Ç—ñ–ª—å–∫–∏ –¥–ª—è wake-up —Å—Ü–µ–Ω–∞—Ä—ñ—ó–≤

### –ö–æ–¥ –ó–º—ñ–Ω:
```javascript
// –ë—É–ª–æ:
port: 80,  // HTTP
if (!healthy) return sendLoadingPage();  // –ë–ª–æ–∫—É–≤–∞–Ω–Ω—è

// –°—Ç–∞–ª–æ:
port: 443,
protocol: 'https',
// –ü—Ä–æ–∫—Å—ñ—é—î–º–æ –≤—ñ–¥—Ä–∞–∑—É, –±–µ–∑ health check –±–ª–æ–∫—É–≤–∞–Ω–Ω—è
return await proxyRequest(req, res, dropletConfig);
```

## üìä –Ø–∫ –ü—Ä–∞—Ü—é—î –ó–∞—Ä–∞–∑

### –ù–æ—Ä–º–∞–ª—å–Ω–∞ –†–æ–±–æ—Ç–∞ (Droplet Active):
```
–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á ‚Üí messenger.kaminskyi.chat
    ‚Üì
Railway Proxy (–ø–µ—Ä–µ–≤—ñ—Ä—è—î DO API)
    ‚Üì
Droplet status: active
    ‚Üì
–ù–ï–ì–ê–ô–ù–ï –ø—Ä–æ–∫—Å—ñ—é–≤–∞–Ω–Ω—è (HTTPS:443)
    ‚Üì
Nginx –Ω–∞ –¥—Ä–æ–ø–ª–µ—Ç—ñ ‚Üí Go App
    ‚Üì
–í—ñ–¥–ø–æ–≤—ñ–¥—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É
```

**–ó–∞—Ç—Ä–∏–º–∫–∞:** ~100-200ms (—Ç—ñ–ª—å–∫–∏ –ø—Ä–æ–∫—Å—ñ)

### Wake-Up –°—Ü–µ–Ω–∞—Ä—ñ–π (Droplet Off):
```
–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á ‚Üí messenger.kaminskyi.chat
    ‚Üì
Railway Proxy (–ø–µ—Ä–µ–≤—ñ—Ä—è—î DO API)
    ‚Üì
Droplet status: off
    ‚Üì
1. –ü–æ–∫–∞–∑—É—î Loading Screen
2. –í—ñ–¥–ø—Ä–∞–≤–ª—è—î power_on –¥–æ DO API
3. –ß–µ–∫–∞—î –ø–æ–∫–∏ droplet —Å—Ç–∞–Ω–µ active
4. –ü–µ—Ä–µ–≤—ñ—Ä—è—î health endpoint
5. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Ä–µ–¥—ñ—Ä–µ–∫—Ç–∏—Ç—å—Å—è
```

**–ó–∞—Ç—Ä–∏–º–∫–∞:** ~15-20 —Å–µ–∫—É–Ω–¥ (boot time)

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –ó–∞—Å–∏–Ω–∞–Ω–Ω—è:
```
Sleep Controller (–∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω)
    ‚Üì
–ü–µ—Ä–µ–≤—ñ—Ä—è—î –∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å:
- Network connections (ports 80, 443, 8080)
- Redis sessions
- Redis meetings
    ‚Üì
–Ø–∫—â–æ idle > 1 –≥–æ–¥–∏–Ω–∞:
1. SAVE Redis data
2. Stop messenger service
3. Stop nginx
4. Shutdown droplet
```

## üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### –¢–µ—Å—Ç 1: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ Proxy ‚úÖ

```bash
curl https://messenger.kaminskyi.chat/api/health
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```json
{
  "redis": true,
  "sfu": true,
  "status": "ready",
  "uptime": 21557.32
}
```

### –¢–µ—Å—Ç 2: –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –°–∞–π—Ç—É ‚úÖ

```bash
curl https://messenger.kaminskyi.chat/
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```html
<title>Kaminskyi Messenger - Secure Video Calls...</title>
```

### –¢–µ—Å—Ç 3: Sleep Controller ‚úÖ

```bash
ssh root@64.227.116.250 "systemctl status sleep-controller"
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
‚óè sleep-controller.service - Droplet Sleep Controller
   Active: active (running)
```

### –¢–µ—Å—Ç 4: –õ–æ–≥–∏ Sleep Controller

```bash
ssh root@64.227.116.250 "journalctl -u sleep-controller -n 20"
```

–ü–æ–∫–∞–∑—É—î –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω.

## ‚öôÔ∏è –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

### –ó–º—ñ–Ω–∏—Ç–∏ –ß–∞—Å –¥–æ –ó–∞—Å–∏–Ω–∞–Ω–Ω—è

–ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º: **1 –≥–æ–¥–∏–Ω–∞** –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ

–©–æ–± –∑–º—ñ–Ω–∏—Ç–∏:

```bash
ssh root@64.227.116.250
nano /usr/local/bin/sleep-controller.sh

# –ó–Ω–∞–π—Ç–∏:
IDLE_TIMEOUT=3600  # —Å–µ–∫—É–Ω–¥–∏

# –ó–º—ñ–Ω–∏—Ç–∏ –Ω–∞ –ø–æ—Ç—Ä—ñ–±–Ω–µ:
# 7200  = 2 –≥–æ–¥–∏–Ω–∏
# 1800  = 30 —Ö–≤–∏–ª–∏–Ω
# 300   = 5 —Ö–≤–∏–ª–∏–Ω (–¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è)

# –ó–±–µ—Ä–µ–≥—Ç–∏ (Ctrl+O, Enter, Ctrl+X)
systemctl restart sleep-controller
```

### –¢–∏–º—á–∞—Å–æ–≤–æ –í—ñ–¥–∫–ª—é—á–∏—Ç–∏ –ì—ñ–±–µ—Ä–Ω–∞—Ü—ñ—é

```bash
ssh root@64.227.116.250 "systemctl stop sleep-controller"
```

–£–≤—ñ–º–∫–Ω—É—Ç–∏ –∑–Ω–æ–≤—É:

```bash
ssh root@64.227.116.250 "systemctl start sleep-controller"
```

### –ü–æ–≤–Ω—ñ—Å—Ç—é –í–∏–¥–∞–ª–∏—Ç–∏ –ì—ñ–±–µ—Ä–Ω–∞—Ü—ñ—é

```bash
ssh root@64.227.116.250 << 'EOF'
systemctl stop sleep-controller
systemctl disable sleep-controller
rm /etc/systemd/system/sleep-controller.service
systemctl daemon-reload
EOF
```

## üí∞ –ï–∫–æ–Ω–æ–º—ñ—è

### –î–æ –ì—ñ–±–µ—Ä–Ω–∞—Ü—ñ—ó:
- **2 –¥—Ä–æ–ø–ª–µ—Ç–∏** √ó $12/–º—ñ—Å = **$24/–º—ñ—Å**
- **–†—ñ–∫**: $288

### –ó –ì—ñ–±–µ—Ä–Ω–∞—Ü—ñ—î—é (—Ä–æ–∑—Ä–æ–±–∫–∞, 20% uptime):
- **Railway**: $0/–º—ñ—Å (free tier)
- **2 –¥—Ä–æ–ø–ª–µ—Ç–∏** √ó $2.40/–º—ñ—Å = **$4.80/–º—ñ—Å**
- **–†—ñ–∫**: $57.60

### üíµ –ó–∞–æ—â–∞–¥–∂—É—î—Ç–µ:
- **$19.20/–º—ñ—Å—è—Ü—å**
- **$230.40/—Ä—ñ–∫**
- **80% –∑–Ω–∏–∂–µ–Ω–Ω—è –≤–∏—Ç—Ä–∞—Ç**

## üìà –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥

### Railway Proxy –õ–æ–≥–∏

```bash
cd "/Users/olehkaminskyi/Desktop/go messenger/hibernation-proxy"
railway logs
```

–ü–æ–∫–∞–∑—É—î:
- –í—Ö—ñ–¥–Ω—ñ –∑–∞–ø–∏—Ç–∏
- –°—Ç–∞—Ç—É—Å –¥—Ä–æ–ø–ª–µ—Ç—ñ–≤
- Wake-up –∫–æ–º–∞–Ω–¥–∏
- Proxy –æ–ø–µ—Ä–∞—Ü—ñ—ó

### Sleep Controller –õ–æ–≥–∏

```bash
ssh root@64.227.116.250 "journalctl -u sleep-controller -f"
```

–ü–æ–∫–∞–∑—É—î:
- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
- –í–∏—è–≤–ª–µ–Ω—ñ –∑'—î–¥–Ω–∞–Ω–Ω—è
- –†—ñ—à–µ–Ω–Ω—è –ø—Ä–æ –∑–∞—Å–∏–Ω–∞–Ω–Ω—è
- –ü—Ä–æ—Ü–µ—Å shutdown

### DigitalOcean Billing

1. https://cloud.digitalocean.com/billing
2. –ü–æ—Ä—ñ–≤–Ω—è–π—Ç–µ –ø–æ—Ç–æ—á–Ω–∏–π –º—ñ—Å—è—Ü—å –∑ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–º
3. –ü–æ–±–∞—á–∏—Ç–µ –µ–∫–æ–Ω–æ–º—ñ—é –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ

### Uptime Tracking

```bash
# Messenger droplet
ssh root@64.227.116.250 "uptime"

# TURN droplet
ssh root@64.226.72.235 "uptime"
```

## üéØ –ù–∞—Å—Ç—É–ø–Ω—ñ –ö—Ä–æ–∫–∏

### –í—Å–µ –ü—Ä–∞—Ü—é—î - –¢–µ–ø–µ—Ä –ú–æ–Ω—ñ—Ç–æ—Ä—Ç–µ:

1. **–ü–µ—Ä—à—ñ 24 –≥–æ–¥–∏–Ω–∏:**
   - –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –ª–æ–≥–∏ sleep-controller –∫–æ–∂–Ω—ñ 2-3 –≥–æ–¥–∏–Ω–∏
   - –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—å —â–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –∑–∞—Å–∏–Ω–∞–Ω–Ω—è –ø—Ä–∞—Ü—é—î
   - –¢–µ—Å—Ç—É–π—Ç–µ wake-up –ø—ñ—Å–ª—è –∑–∞—Å–∏–Ω–∞–Ω–Ω—è

2. **–ü–µ—Ä—à–∏–π —Ç–∏–∂–¥–µ–Ω—å:**
   - –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ DigitalOcean billing
   - –ù–∞–ª–∞—à—Ç—É–π—Ç–µ idle timeout –ø—ñ–¥ –≤–∞—à—ñ –ø–æ—Ç—Ä–µ–±–∏
   - –í—ñ–¥—Å—Ç–µ–∂—É–π—Ç–µ uptime percentage

3. **–ü–µ—Ä—à–∏–π –º—ñ—Å—è—Ü—å:**
   - –ü—ñ–¥—Ä–∞—Ö—É–π—Ç–µ —Ä–µ–∞–ª—å–Ω—É –µ–∫–æ–Ω–æ–º—ñ—é
   - –û–ø—Ç–∏–º—ñ–∑—É–π—Ç–µ idle timeout
   - –í–∏—Ä—ñ—à—ñ—Ç—å —á–∏ –∑–∞–ª–∏—à–∞—Ç–∏ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω

## ‚ö†Ô∏è –í–∞–∂–ª–∏–≤—ñ –ù–æ—Ç–∞—Ç–∫–∏

### –î–ª—è –†–æ–∑—Ä–æ–±–∫–∏: ‚úÖ –Ü–¥–µ–∞–ª—å–Ω–æ
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –∑–∞—Å–∏–Ω–∞–Ω–Ω—è –µ–∫–æ–Ω–æ–º–∏—Ç—å –≥—Ä–æ—à—ñ
- Wake-up –∑–∞ 15-20 —Å–µ–∫—É–Ω–¥ –ø—Ä–∏–π–Ω—è—Ç–Ω–æ
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –ø—Ä–∞—Ü—é—î

### –î–ª—è –ü—Ä–æ–¥–∞–∫—à–Ω: ‚ö†Ô∏è –í–∏–º–∫–Ω—ñ—Ç—å –ì—ñ–±–µ—Ä–Ω–∞—Ü—ñ—é
- 15-20 —Å–µ–∫—É–Ω–¥ –∑–∞—Ç—Ä–∏–º–∫–∞ –Ω–µ–ø—Ä–∏–π–Ω—è—Ç–Ω–∞ –¥–ª—è —é–∑–µ—Ä—ñ–≤
- –í–∏–º–∫–Ω—ñ—Ç—å sleep-controller –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º
- –ó–∞–ª–∏—à—Ç–µ —Ç—ñ–ª—å–∫–∏ Railway proxy –¥–ª—è –±–∞–ª–∞–Ω—Å—É–≤–∞–Ω–Ω—è

```bash
# –ü–µ—Ä–µ–¥ –ø—Ä–æ–¥–∞–∫—à–Ω –∑–∞–ø—É—Å–∫–æ–º:
ssh root@64.227.116.250 "systemctl stop sleep-controller && systemctl disable sleep-controller"
```

## üîó –ö–æ—Ä–∏—Å–Ω—ñ –ü–æ—Å–∏–ª–∞–Ω–Ω—è

- **Railway Dashboard**: https://railway.app/project/9f0dc4d5-42b5-4fa1-a6f5-62c3db54d1df
- **Messenger**: https://messenger.kaminskyi.chat
- **DigitalOcean**: https://cloud.digitalocean.com/droplets

## üìû –®–≤–∏–¥–∫—ñ –ö–æ–º–∞–Ω–¥–∏

```bash
# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å–∞–π—Ç—É
curl https://messenger.kaminskyi.chat/api/health

# Railway –ª–æ–≥–∏
cd hibernation-proxy && railway logs

# Sleep controller —Å—Ç–∞—Ç—É—Å
ssh root@64.227.116.250 "systemctl status sleep-controller"

# Sleep controller –ª–æ–≥–∏
ssh root@64.227.116.250 "journalctl -u sleep-controller -f"

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ sleep controller
ssh root@64.227.116.250 "systemctl restart sleep-controller"

# Uptime
ssh root@64.227.116.250 "uptime"
```

---

## ‚úÖ –í–ò–°–ù–û–í–û–ö

**–°–∏—Å—Ç–µ–º–∞ –ø–æ–≤–Ω—ñ—Å—Ç—é –ø—Ä–∞—Ü—é—î —ñ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∞!**

- ‚úÖ Railway proxy –ø—Ä–æ–∫—Å—ñ—é—î –∑–∞–ø–∏—Ç–∏ –∫–æ—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ Health endpoint –ø–æ–≤–µ—Ä—Ç–∞—î –ø—Ä–∞–≤–∏–ª—å–Ω—ñ –¥–∞–Ω—ñ
- ‚úÖ Sleep controller –º–æ–Ω—ñ—Ç–æ—Ä–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –∑–∞—Å–∏–Ω–∞–Ω–Ω—è —á–µ—Ä–µ–∑ 1 –≥–æ–¥–∏–Ω—É
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –ø—Ä–æ–∫–∏–¥–∞–Ω–Ω—è –∑–∞ 15-20 —Å–µ–∫—É–Ω–¥
- ‚úÖ –ï–∫–æ–Ω–æ–º—ñ—è $230/—Ä—ñ–∫

**–ù–∞—Å–ª—ñ–¥—É–π—Ç–µ—Å—å –µ–∫–æ–Ω–æ–º—ñ—î—é! üöÄüí∞**

---

**–î–∞—Ç–∞**: 8 –∂–æ–≤—Ç–Ω—è 2025, 04:02 UTC
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –í–∏—Ä–æ–±–Ω–∏—á–∏–π
**–í–µ—Ä—Å—ñ—è**: 1.0 (–°—Ç–∞–±—ñ–ª—å–Ω–∞)
