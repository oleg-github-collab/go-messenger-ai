<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">
    <title>Video Call - Kaminskyi Messenger</title>
    <link rel="stylesheet" href="/static/call.css">
</head>
<body>
    <div class="call-container" id="callContainer">
        <!-- Remote video (full screen) -->
        <video id="remoteVideo" class="remote-video" autoplay playsinline></video>

        <!-- Remote placeholder -->
        <div id="remotePlaceholder" class="remote-placeholder">
            <div class="avatar-large">?</div>
            <div class="placeholder-name">Connecting...</div>
        </div>

        <!-- Local video (PiP window top-right) -->
        <div class="local-pip" id="localPip">
            <video id="localVideo" autoplay muted playsinline></video>
            <button class="pip-expand-btn" id="pipExpandBtn">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                    <path d="M2 14L6 10M6 10V14M6 10H2M14 2L10 6M10 6V2M10 6H14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
            </button>
        </div>

        <!-- Back button (top-left) -->
        <button class="back-button" id="backButton">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </button>

        <!-- User info (bottom-left) -->
        <div class="user-info-box">
            <div class="user-label" id="userLabel">Guest</div>
            <div class="user-display-name" id="userName">Loading...</div>
        </div>

        <!-- Call timer (bottom-left, below name) -->
        <div class="call-timer-box" id="callTimerBox">
            <span class="recording-indicator"></span>
            <span class="timer-text" id="timerText">00:00</span>
        </div>

        <!-- Right side controls (vertical) -->
        <div class="right-side-controls">
            <button class="round-control-btn" id="cameraBtn" data-active="true">
                <svg class="icon-camera-on" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4z"/>
                </svg>
                <svg class="icon-camera-off" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" style="display: none;">
                    <path d="M21 6.5l-4 4V7c0-.55-.45-1-1-1H9.82L21 17.18V6.5zM3.27 2L2 3.27 4.73 6H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.21 0 .39-.08.54-.18L19.73 21 21 19.73 3.27 2z"/>
                </svg>
            </button>

            <button class="round-control-btn" id="microphoneBtn" data-active="true">
                <svg class="icon-mic-on" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
                    <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
                </svg>
                <svg class="icon-mic-off" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" style="display: none;">
                    <path d="M19 11h-1.7c0 .74-.16 1.43-.43 2.05l1.23 1.23c.56-.98.9-2.09.9-3.28zm-4.02.17c0-.06.02-.11.02-.17V5c0-1.66-1.34-3-3-3S9 3.34 9 5v.18l5.98 5.99zM4.27 3L3 4.27l6.01 6.01V11c0 1.66 1.33 3 2.99 3 .22 0 .44-.03.65-.08l1.66 1.66c-.71.33-1.5.52-2.31.52-2.76 0-5.3-2.1-5.3-5.1H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c.91-.13 1.77-.45 2.54-.9L19.73 21 21 19.73 4.27 3z"/>
                </svg>
            </button>

            <!-- Flip camera button - only on mobile -->
            <button class="round-control-btn mobile-only" id="flipCameraBtn">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M20 5h-3.17L15 3H9L7.17 5H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm-8 13c-2.76 0-5-2.24-5-5H5l2.5-2.5L10 13H8c0 2.21 1.79 4 4 4s4-1.79 4-4h-2l2.5-2.5L19 11h-2c0 2.76-2.24 5-5 5z"/>
                </svg>
            </button>
        </div>

        <!-- Bottom bar (dark rounded) -->
        <div class="bottom-control-bar">
            <!-- End call button (center, large, red) -->
            <button class="end-call-button" id="endCallButton">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 9c-1.6 0-3.15.25-4.6.72v3.1c0 .39-.23.74-.56.9-.98.49-1.87 1.12-2.66 1.85-.18.18-.43.28-.7.28-.28 0-.53-.11-.71-.29L.29 13.08c-.18-.17-.29-.42-.29-.7 0-.28.11-.53.29-.71C3.34 8.78 7.46 7 12 7s8.66 1.78 11.71 4.67c.18.18.29.43.29.71 0 .28-.11.53-.29.71l-2.48 2.48c-.18.18-.43.29-.71.29-.27 0-.52-.11-.7-.28-.79-.74-1.69-1.36-2.67-1.85-.33-.16-.56-.5-.56-.9v-3.1C15.15 9.25 13.6 9 12 9z"/>
                </svg>
            </button>

            <!-- Bottom action icons -->
            <div class="bottom-actions">
                <button class="bottom-action-btn" id="shareScreenBtn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z"/>
                    </svg>
                </button>

                <button class="bottom-action-btn" id="chatIconBtn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM9 11H7V9h2v2zm4 0h-2V9h2v2zm4 0h-2V9h2v2z"/>
                    </svg>
                    <span class="notification-badge" id="chatBadge" style="display: none;">1</span>
                </button>

                <button class="bottom-action-btn" id="moreOptionsBtn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Chat panel (full screen overlay) -->
        <div class="chat-panel" id="chatPanel">
            <div class="chat-header">
                <button class="chat-back-btn" id="chatBackBtn">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>Back to call</span>
                </button>
            </div>
            <div class="chat-messages-container" id="chatMessages">
                <div class="chat-empty-state" id="chatEmpty">
                    <div class="chat-empty-icon">üí¨</div>
                    <div class="chat-empty-title">No messages yet</div>
                    <div class="chat-empty-subtitle">Send a message to start the conversation</div>
                </div>
            </div>
            <div class="chat-input-area">
                <button class="emoji-btn" id="emojiBtn" title="Emoji & GIF">üòä</button>
                <input type="text" id="messageInput" placeholder="Type a message..." />
                <button id="sendMessageBtn" class="send-message-btn">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Emoji & GIF Picker -->
        <div class="emoji-picker" id="emojiPicker">
            <div class="emoji-header">
                <div class="emoji-tabs">
                    <button class="emoji-tab active" data-tab="emoji">üòä Emoji</button>
                    <button class="emoji-tab" data-tab="gif">GIF</button>
                </div>
                <button class="emoji-close" id="emojiClose">‚úï</button>
            </div>

            <!-- Emoji Tab -->
            <div class="emoji-content" id="emojiContent">
                <div class="emoji-categories">
                    <button class="emoji-category active" data-category="smileys">üòÄ</button>
                    <button class="emoji-category" data-category="gestures">üëã</button>
                    <button class="emoji-category" data-category="people">üë®</button>
                    <button class="emoji-category" data-category="animals">üê∂</button>
                    <button class="emoji-category" data-category="food">üçï</button>
                    <button class="emoji-category" data-category="travel">‚úàÔ∏è</button>
                    <button class="emoji-category" data-category="objects">‚öΩ</button>
                    <button class="emoji-category" data-category="symbols">‚ù§Ô∏è</button>
                </div>
                <div class="emoji-grid" id="emojiGrid"></div>
            </div>

            <!-- GIF Tab -->
            <div class="gif-content" id="gifContent" style="display: none;">
                <input type="text" class="gif-search" id="gifSearch" placeholder="Search GIFs..." />
                <div class="gif-categories" id="gifCategories"></div>
                <div class="gif-grid" id="gifGrid"></div>
            </div>
        </div>

        <!-- Settings Panel -->
        <div class="settings-panel" id="settingsPanel">
            <div class="settings-header">
                <h3>Settings</h3>
                <button class="settings-close" id="settingsClose">‚úï</button>
            </div>
            <div class="settings-content">
                <!-- Video Quality -->
                <div class="settings-group">
                    <label class="settings-label">Video Quality</label>
                    <select class="settings-select" id="videoQualitySelect">
                        <option value="auto">Auto (Adaptive)</option>
                        <option value="1080p" selected>Full HD (1080p)</option>
                        <option value="720p">HD (720p)</option>
                        <option value="480p">SD (480p)</option>
                        <option value="360p">Low (360p)</option>
                    </select>
                    <p class="settings-description">Automatically adjusts based on connection quality</p>
                </div>

                <!-- Frame Rate -->
                <div class="settings-group">
                    <label class="settings-label">Frame Rate</label>
                    <select class="settings-select" id="frameRateSelect">
                        <option value="auto">Auto</option>
                        <option value="60">60 FPS</option>
                        <option value="30" selected>30 FPS</option>
                        <option value="24">24 FPS</option>
                        <option value="15">15 FPS</option>
                    </select>
                </div>

                <!-- Audio Quality -->
                <div class="settings-group">
                    <label class="settings-label">Audio Quality</label>
                    <select class="settings-select" id="audioQualitySelect">
                        <option value="high" selected>High (48kHz)</option>
                        <option value="medium">Medium (44.1kHz)</option>
                        <option value="low">Low (32kHz)</option>
                    </select>
                </div>

                <!-- Echo Cancellation -->
                <div class="settings-group">
                    <label class="settings-label">
                        <input type="checkbox" id="echoCancellation" checked>
                        Echo Cancellation
                    </label>
                </div>

                <!-- Noise Suppression -->
                <div class="settings-group">
                    <label class="settings-label">
                        <input type="checkbox" id="noiseSuppression" checked>
                        Noise Suppression
                    </label>
                </div>

                <!-- Auto Gain -->
                <div class="settings-group">
                    <label class="settings-label">
                        <input type="checkbox" id="autoGain" checked>
                        Auto Gain Control
                    </label>
                </div>

                <!-- Connection Stats -->
                <div class="settings-group">
                    <label class="settings-label">Connection Stats</label>
                    <div class="connection-stats">
                        <div class="stat-item">
                            <span class="stat-label">Latency:</span>
                            <span class="stat-value" id="latencyStat">-- ms</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Bitrate:</span>
                            <span class="stat-value" id="bitrateStat">-- kbps</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Packet Loss:</span>
                            <span class="stat-value" id="packetLossStat">-- %</span>
                        </div>
                    </div>
                </div>

                <!-- Apply Button -->
                <button class="settings-apply-btn" id="settingsApply">Apply Changes</button>
            </div>
        </div>

        <!-- Settings Backdrop -->
        <div class="settings-backdrop" id="settingsBackdrop"></div>
    </div>

    <script src="/static/force-browser.js"></script>
    <script src="/static/webrtc.js"></script>
    <script src="/static/call-features.js"></script>
    <script src="/static/waiting-room.js"></script>
    <script src="/static/call.js"></script>
</body>
</html>
