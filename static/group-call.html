<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">
    <title>Group Call - Kaminskyi Messenger</title>
    <link rel="stylesheet" href="/static/group-call.css">
</head>
<body>
    <!-- Settings Screen (shown before joining) -->
    <div class="settings-screen" id="settingsScreen">
        <div class="settings-container">
            <h1 class="settings-title">Join Group Call</h1>

            <div class="preview-container">
                <video id="previewVideo" autoplay muted playsinline></video>
                <div class="preview-status" id="previewStatus">Starting camera...</div>
            </div>

            <div class="settings-form">
                <div class="form-group">
                    <label for="nameInput" data-i18n="your-name">Your Name</label>
                    <input type="text" id="nameInput" placeholder="Enter your name" maxlength="30" autocomplete="name" data-i18n-placeholder="enter-name">
                </div>

                <div class="form-group">
                    <label for="languageSelect" data-i18n="language">Language</label>
                    <select id="languageSelect" class="language-select">
                        <option value="en">English</option>
                        <option value="uk" selected>–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</option>
                    </select>
                </div>

                <div class="settings-toggles">
                    <div class="toggle-item">
                        <div class="toggle-info">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4z"/>
                            </svg>
                            <span>Camera</span>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="cameraToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>

                    <div class="toggle-item">
                        <div class="toggle-info">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
                                <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
                            </svg>
                            <span>Microphone</span>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="micToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <button class="join-button" id="joinButton">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M11 15h2v2h-2zm0-8h2v6h-2zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"/>
                    </svg>
                    Join Call
                </button>
            </div>
        </div>
    </div>

    <div class="group-call-container" id="groupCallContainer" data-view-mode="video" style="display: none;">
        <!-- Cinematic subtitle overlay -->
        <div class="subtitle-overlay" id="subtitleOverlay"></div>

        <!-- Participants grid -->
        <div class="participants-grid" id="participantsGrid" data-count="0">
            <!-- Local participant -->
            <div class="participant-tile local" id="localTile">
                <video id="localVideo" autoplay muted playsinline></video>
                <div class="speaking-indicator">
                    üé§ Speaking
                    <div class="speaking-wave"></div>
                    <div class="speaking-wave"></div>
                    <div class="speaking-wave"></div>
                </div>
                <div class="participant-name">You</div>
                <div class="participant-status">
                    <span class="mic-indicator" id="localMicIndicator"></span>
                </div>
            </div>
        </div>

        <!-- Top controls -->
        <div class="top-controls">
            <button class="back-button" id="backButton">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                    <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/>
                </svg>
            </button>

            <div class="call-info">
                <div class="participant-count" id="participantCount">1 participant</div>
                <div class="call-timer" id="callTimer">00:00</div>
            </div>
        </div>

        <!-- Bottom controls -->
        <div class="bottom-controls">
            <button class="control-btn" id="cameraBtn" data-active="true">
                <svg class="icon-on" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4z"/>
                </svg>
                <svg class="icon-off" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" style="display: none;">
                    <path d="M21 6.5l-4 4V7c0-.55-.45-1-1-1H9.82L21 17.18V6.5zM3.27 2L2 3.27 4.73 6H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.21 0 .39-.08.54-.18L19.73 21 21 19.73 3.27 2z"/>
                </svg>
                <span class="btn-label">Camera</span>
            </button>

            <button class="control-btn" id="micBtn" data-active="true">
                <svg class="icon-on" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
                    <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
                </svg>
                <svg class="icon-off" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" style="display: none;">
                    <path d="M19 11h-1.7c0 .74-.16 1.43-.43 2.05l1.23 1.23c.56-.98.9-2.09.9-3.28zm-4.02.17c0-.06.02-.11.02-.17V5c0-1.66-1.34-3-3-3S9 3.34 9 5v.18l5.98 5.99zM4.27 3L3 4.27l6.01 6.01V11c0 1.66 1.33 3 2.99 3 .22 0 .44-.03.65-.08l1.66 1.66c-.71.33-1.5.52-2.31.52-2.76 0-5.3-2.1-5.3-5.1H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c.91-.13 1.77-.45 2.54-.9L19.73 21 21 19.73 4.27 3z"/>
                </svg>
                <span class="btn-label">Mic</span>
            </button>

            <button class="end-call-btn" id="endCallBtn">
                <svg width="28" height="28" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 9c-1.6 0-3.15.25-4.6.72v3.1c0 .39-.23.74-.56.9-.98.49-1.87 1.12-2.66 1.85-.18.18-.43.28-.7.28-.28 0-.53-.11-.71-.29L.29 13.08c-.18-.17-.29-.42-.29-.7 0-.28.11-.53.29-.71C3.34 8.78 7.46 7 12 7s8.66 1.78 11.71 4.67c.18.18.29.43.29.71 0 .28-.11.53-.29.71l-2.48 2.48c-.18.18-.43.29-.71.29-.27 0-.52-.11-.7-.28-.79-.74-1.69-1.36-2.67-1.85-.33-.16-.56-.5-.56-.9v-3.1C15.15 9.25 13.6 9 12 9z"/>
                </svg>
            </button>

            <button class="control-btn" id="reactionsBtn" title="Reactions">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm3.5-9c.83 0 1.5-.67 1.5-1.5S16.33 8 15.5 8 14 8.67 14 9.5s.67 1.5 1.5 1.5zm-7 0c.83 0 1.5-.67 1.5-1.5S9.33 8 8.5 8 7 8.67 7 9.5 7.67 11 8.5 11zm3.5 6.5c2.33 0 4.31-1.46 5.11-3.5H6.89c.8 2.04 2.78 3.5 5.11 3.5z"/>
                </svg>
                <span class="btn-label">React</span>
            </button>

            <button class="control-btn" id="raiseHandBtn" title="Raise Hand">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M23 5.5V20c0 2.2-1.8 4-4 4h-7.3c-1.08 0-2.1-.43-2.85-1.19L1 14.83s1.26-1.23 1.3-1.25c.22-.19.49-.29.79-.29.22 0 .42.06.6.16.04.01 4.31 2.46 4.31 2.46V4c0-.83.67-1.5 1.5-1.5S11 3.17 11 4v7h1V1.5c0-.83.67-1.5 1.5-1.5S15 .67 15 1.5V11h1V2.5c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5V11h1V5.5c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5z"/>
                </svg>
                <span class="btn-label">Hand</span>
            </button>

            <button class="control-btn" id="chatToggleBtn">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/>
                </svg>
                <span class="btn-label" id="chatBtnLabel">Chat</span>
                <span class="chat-badge" id="chatBadge" style="display: none;">0</span>
            </button>

            <button class="control-btn" id="participantsBtn">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/>
                </svg>
                <span class="btn-label">People</span>
            </button>
        </div>

        <!-- Chat Panel -->
        <div class="chat-panel" id="chatPanel">
            <div class="chat-header">
                <button class="chat-back-btn" id="chatBackBtn">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
                <div class="chat-title">
                    <h3>Chat</h3>
                    <select class="recipient-select-header" id="recipientSelect">
                        <option value="everyone">Everyone</option>
                    </select>
                </div>
            </div>

            <!-- Reply Preview Bar -->
            <div class="reply-preview" id="replyPreview" style="display: none;">
                <div class="reply-preview-content">
                    <div class="reply-preview-label">Replying to <span id="replyToName"></span></div>
                    <div class="reply-preview-text" id="replyToText"></div>
                </div>
                <button class="reply-preview-close" id="replyPreviewClose">‚úï</button>
            </div>

            <div class="chat-messages" id="chatMessages">
                <div class="chat-empty-state" id="chatEmpty">
                    <div class="chat-empty-icon">üí¨</div>
                    <div class="chat-empty-title">No messages yet</div>
                    <div class="chat-empty-subtitle">Send a message to start the conversation</div>
                </div>
            </div>

            <div class="chat-input-container">
                <div class="chat-input-area">
                    <button class="chat-action-btn" id="emojiBtn" title="Emoji & GIF">
                        <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm3.5-9c.83 0 1.5-.67 1.5-1.5S16.33 8 15.5 8 14 8.67 14 9.5s.67 1.5 1.5 1.5zm-7 0c.83 0 1.5-.67 1.5-1.5S9.33 8 8.5 8 7 8.67 7 9.5 7.67 11 8.5 11zm3.5 6.5c2.33 0 4.31-1.46 5.11-3.5H6.89c.8 2.04 2.78 3.5 5.11 3.5z"/>
                        </svg>
                    </button>
                    <input type="text" id="messageInput" placeholder="Message..." maxlength="500" />
                    <button id="sendMessageBtn" class="send-message-btn">
                        <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Participants List Modal -->
        <div class="participants-modal" id="participantsModal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Participants</h3>
                    <button class="modal-close" id="participantsModalClose">‚úï</button>
                </div>
                <div class="participants-list" id="participantsList"></div>
            </div>
        </div>

        <!-- Flying Reactions Container -->
        <div class="flying-reactions" id="flyingReactions"></div>

        <!-- Quick Reactions Panel -->
        <div class="quick-reactions-panel" id="quickReactionsPanel" style="display: none;">
            <button class="reaction-option" data-emoji="üëç">üëç</button>
            <button class="reaction-option" data-emoji="‚ù§Ô∏è">‚ù§Ô∏è</button>
            <button class="reaction-option" data-emoji="üòÇ">üòÇ</button>
            <button class="reaction-option" data-emoji="üëè">üëè</button>
            <button class="reaction-option" data-emoji="üî•">üî•</button>
            <button class="reaction-option" data-emoji="üéâ">üéâ</button>
        </div>

        <!-- Emoji/GIF Picker Panel -->
        <div class="emoji-picker-panel" id="emojiPickerPanel">
            <div class="emoji-picker-header">
                <div class="emoji-picker-tabs">
                    <button class="emoji-tab active" data-tab="emoji">üòä Emoji</button>
                    <button class="emoji-tab" data-tab="gif">GIF</button>
                </div>
                <button class="emoji-close" id="emojiPickerClose">‚úï</button>
            </div>

            <!-- Emoji Content -->
            <div class="emoji-content" id="emojiContent">
                <div class="emoji-categories">
                    <button class="emoji-category active" data-category="smileys">üòÄ</button>
                    <button class="emoji-category" data-category="gestures">üëã</button>
                    <button class="emoji-category" data-category="people">üë®</button>
                    <button class="emoji-category" data-category="animals">üê∂</button>
                    <button class="emoji-category" data-category="food">üçï</button>
                    <button class="emoji-category" data-category="travel">‚úàÔ∏è</button>
                    <button class="emoji-category" data-category="objects">‚öΩ</button>
                    <button class="emoji-category" data-category="symbols">‚ù§Ô∏è</button>
                </div>
                <div class="emoji-grid" id="emojiGrid"></div>
            </div>

            <!-- GIF Content -->
            <div class="gif-content" id="gifContent" style="display: none;">
                <input type="text" class="gif-search" id="gifSearch" placeholder="Search GIFs..." />
                <div class="gif-categories" id="gifCategories"></div>
                <div class="gif-grid" id="gifGrid"></div>
            </div>
        </div>
    </div>

    <script src="/static/force-browser.js"></script>
    <script src="/static/emoji-gif-picker.js"></script>
    <script src="/static/group-call.js"></script>
</body>
</html>
