# –°—Ç—Ä–∞—Ç–µ–≥—ñ—è –ó–∞—Å–∏–Ω–∞–Ω–Ω—è/–ü—Ä–æ–∫–∏–¥–∞–Ω–Ω—è –î—Ä–æ–ø–ª–µ—Ç—ñ–≤ –¥–ª—è –ï–∫–æ–Ω–æ–º—ñ—ó

**–î–∞—Ç–∞:** 2025-10-07
**–ú–µ—Ç–∞:** –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –µ–∫–æ–Ω–æ–º—ñ—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–∞—Ö –ø—ñ–¥ —á–∞—Å —Ä–æ–∑—Ä–æ–±–∫–∏ –±–µ–∑ —à–∫–æ–¥–∏ –¥–ª—è UX

## üí∞ –ï–ö–û–ù–û–ú–Ü–ß–ù–ò–ô –ê–ù–ê–õ–Ü–ó

### –ü–æ—Ç–æ—á–Ω—ñ –í–∏—Ç—Ä–∞—Ç–∏

**2 –î—Ä–æ–ø–ª–µ—Ç–∏ DigitalOcean:**
1. **kaminskyi-messenger-production** (64.227.116.250)
   - –¢–∏–ø: Basic Droplet ($6/month –∞–±–æ $0.009/hour)
   - 24/7 —Ä–æ–±–æ—Ç–∏: $6/month √ó 1 = $6/month

2. **kaminskyi-turn-production** (64.226.72.235)
   - –¢–∏–ø: Basic Droplet ($6/month –∞–±–æ $0.009/hour)
   - 24/7 —Ä–æ–±–æ—Ç–∏: $6/month √ó 1 = $6/month

**–ó–∞–≥–∞–ª—å–Ω—ñ –≤–∏—Ç—Ä–∞—Ç–∏:** $12/month ($144/year)

### –ü–æ—Ç–µ–Ω—Ü—ñ–π–Ω–∞ –ï–∫–æ–Ω–æ–º—ñ—è

**–°—Ü–µ–Ω–∞—Ä—ñ–π 1: –ê–∫—Ç–∏–≤–Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è 20% —á–∞—Å—É**
- –ê–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å: 5 –≥–æ–¥–∏–Ω/–¥–µ–Ω—å (—Ä–æ–±–æ—á–∏–π —á–∞—Å + —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è)
- –°–æ–Ω: 19 –≥–æ–¥–∏–Ω/–¥–µ–Ω—å
- –ï–∫–æ–Ω–æ–º—ñ—è: **$9.60/month (80%)**
- –ù–æ–≤—ñ –≤–∏—Ç—Ä–∞—Ç–∏: $2.40/month

**–°—Ü–µ–Ω–∞—Ä—ñ–π 2: –ê–∫—Ç–∏–≤–Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è 10% —á–∞—Å—É**
- –ê–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å: 2.5 –≥–æ–¥–∏–Ω–∏/–¥–µ–Ω—å (—Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è)
- –°–æ–Ω: 21.5 –≥–æ–¥–∏–Ω/–¥–µ–Ω—å
- –ï–∫–æ–Ω–æ–º—ñ—è: **$10.80/month (90%)**
- –ù–æ–≤—ñ –≤–∏—Ç—Ä–∞—Ç–∏: $1.20/month

**–°—Ü–µ–Ω–∞—Ä—ñ–π 3: –¢—ñ–ª—å–∫–∏ –¥–ª—è –¥–µ–º–æ**
- –ê–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å: 30 —Ö–≤–∏–ª–∏–Ω/–¥–µ–Ω—å
- –°–æ–Ω: 23.5 –≥–æ–¥–∏–Ω/–¥–µ–Ω—å
- –ï–∫–æ–Ω–æ–º—ñ—è: **$11.52/month (96%)**
- –ù–æ–≤—ñ –≤–∏—Ç—Ä–∞—Ç–∏: $0.48/month

## üéØ –ê–õ–ì–û–†–ò–¢–ú –ó–ê–°–ò–ù–ê–ù–ù–Ø/–ü–†–û–ö–ò–î–ê–ù–ù–Ø

### –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ –†—ñ—à–µ–Ω–Ω—è

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    CloudFlare Worker                         ‚îÇ
‚îÇ  (Always-On, Free Tier, Global Edge Network)                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ
                            ‚Üì
            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
            ‚îÇ                               ‚îÇ
            ‚Üì                               ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Messenger Droplet   ‚îÇ       ‚îÇ    TURN Droplet       ‚îÇ
‚îÇ    (Auto-Sleep)       ‚îÇ       ‚îÇ   (Auto-Sleep)        ‚îÇ
‚îÇ                       ‚îÇ       ‚îÇ                       ‚îÇ
‚îÇ ‚Ä¢ Nginx               ‚îÇ       ‚îÇ ‚Ä¢ Coturn              ‚îÇ
‚îÇ ‚Ä¢ Go Messenger        ‚îÇ       ‚îÇ                       ‚îÇ
‚îÇ ‚Ä¢ Redis               ‚îÇ       ‚îÇ                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ –°–∏—Å—Ç–µ–º–∏

#### 1. CloudFlare Worker (–ü—Ä–æ–∫—Å—ñ + Wake-Up)

**–†–æ–ª—å:**
- –ü—Ä–∏–π–º–∞—î –≤—Å—ñ –∑–∞–ø–∏—Ç–∏ –¥–æ messenger.kaminskyi.chat
- –ü–µ—Ä–µ–≤—ñ—Ä—è—î —Å—Ç–∞—Ç—É—Å –¥—Ä–æ–ø–ª–µ—Ç—ñ–≤
- –ë—É–¥–∏—Ç—å —Å–ø–ª—è—á—ñ –¥—Ä–æ–ø–ª–µ—Ç–∏
- –ü–æ–∫–∞–∑—É—î "Loading..." –µ–∫—Ä–∞–Ω –ø—ñ–¥ —á–∞—Å –ø—Ä–æ–±—É–¥–∂–µ–Ω–Ω—è
- –ü—Ä–æ–∫—Å—É—î –∑–∞–ø–∏—Ç–∏ –¥–æ –∞–∫—Ç–∏–≤–Ω–∏—Ö –¥—Ä–æ–ø–ª–µ—Ç—ñ–≤

**–ü–µ—Ä–µ–≤–∞–≥–∏:**
- ‚úÖ –ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ (Free Tier: 100,000 requests/day)
- ‚úÖ Global CDN (—à–≤–∏–¥–∫–∏–π –≤—ñ–¥–≥—É–∫ –∑ –±—É–¥—å-—è–∫–æ—ó —Ç–æ—á–∫–∏ —Å–≤—ñ—Ç—É)
- ‚úÖ –ù–∏–∑—å–∫–∞ –∑–∞—Ç—Ä–∏–º–∫–∞ (edge computing)
- ‚úÖ –ù–µ –ø–æ—Ç—Ä–µ–±—É—î –≤–ª–∞—Å–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞

**–ö–æ–¥ CloudFlare Worker:**
```javascript
// cloudflare-worker.js
const DROPLET_IPS = {
  messenger: '64.227.116.250',
  turn: '64.226.72.235'
};

const DO_API_TOKEN = 'YOUR_DIGITALOCEAN_API_TOKEN';
const DROPLET_IDS = {
  messenger: 522123449, // –¢–≤—ñ–π ID –¥—Ä–æ–ø–ª–µ—Ç–∞
  turn: 522123497        // –¢–≤—ñ–π ID –¥—Ä–æ–ø–ª–µ—Ç–∞
};

addEventListener('fetch', event => {
  event.respondWith(handleRequest(event.request));
});

async function handleRequest(request) {
  const url = new URL(request.url);

  // –í–∏–∑–Ω–∞—á–∏—Ç–∏ —è–∫–∏–π –¥—Ä–æ–ø–ª–µ—Ç –ø–æ—Ç—Ä—ñ–±–µ–Ω
  const targetDroplet = determineTargetDroplet(url);

  // –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å –¥—Ä–æ–ø–ª–µ—Ç–∞
  const status = await checkDropletStatus(targetDroplet);

  if (status === 'off') {
    // –î—Ä–æ–ø–ª–µ—Ç —Å–ø–∏—Ç—å - –±—É–¥–∏–º–æ –π–æ–≥–æ
    console.log(`Waking up ${targetDroplet}...`);
    await wakeUpDroplet(targetDroplet);

    // –ü–æ–∫–∞–∑–∞—Ç–∏ loading –µ–∫—Ä–∞–Ω
    return new Response(getLoadingHTML(), {
      headers: {
        'Content-Type': 'text/html',
        'Refresh': '15; url=' + request.url // –ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —á–µ—Ä–µ–∑ 15 —Å–µ–∫
      }
    });
  } else if (status === 'booting') {
    // –î—Ä–æ–ø–ª–µ—Ç –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è
    return new Response(getLoadingHTML('Server is starting...'), {
      headers: {
        'Content-Type': 'text/html',
        'Refresh': '5; url=' + request.url // –ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —á–µ—Ä–µ–∑ 5 —Å–µ–∫
      }
    });
  }

  // –î—Ä–æ–ø–ª–µ—Ç –∞–∫—Ç–∏–≤–Ω–∏–π - –ø—Ä–æ–∫—Å—É—î–º–æ –∑–∞–ø–∏—Ç
  return proxyToDroplet(request, targetDroplet);
}

function determineTargetDroplet(url) {
  // TURN server –ø–æ—Ç—Ä—ñ–±–µ–Ω –¥–ª—è WebRTC connections
  if (url.pathname.includes('/turn') || url.port === '3478') {
    return 'turn';
  }
  return 'messenger';
}

async function checkDropletStatus(droplet) {
  const dropletId = DROPLET_IDS[droplet];

  const response = await fetch(
    `https://api.digitalocean.com/v2/droplets/${dropletId}`,
    {
      headers: {
        'Authorization': `Bearer ${DO_API_TOKEN}`,
        'Content-Type': 'application/json'
      }
    }
  );

  const data = await response.json();
  return data.droplet.status; // 'active', 'off', 'new', 'archive'
}

async function wakeUpDroplet(droplet) {
  const dropletId = DROPLET_IDS[droplet];

  // Power on droplet
  const response = await fetch(
    `https://api.digitalocean.com/v2/droplets/${dropletId}/actions`,
    {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${DO_API_TOKEN}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        type: 'power_on'
      })
    }
  );

  return response.json();
}

async function proxyToDroplet(request, droplet) {
  const targetIP = DROPLET_IPS[droplet];
  const url = new URL(request.url);

  // –ó–∞–º—ñ–Ω–∏—Ç–∏ host –Ω–∞ IP –¥—Ä–æ–ø–ª–µ—Ç–∞
  url.hostname = targetIP;

  // –ü—Ä–æ–∫—Å—É–≤–∞—Ç–∏ –∑–∞–ø–∏—Ç
  const modifiedRequest = new Request(url, {
    method: request.method,
    headers: request.headers,
    body: request.body
  });

  return fetch(modifiedRequest);
}

function getLoadingHTML(message = 'Server is waking up...') {
  return `
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Starting Server...</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
    }
    .container {
      text-align: center;
      color: white;
    }
    .spinner {
      width: 80px;
      height: 80px;
      border: 8px solid rgba(255, 255, 255, 0.3);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 32px;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    h1 {
      font-size: 32px;
      margin: 0 0 16px;
      font-weight: 700;
    }
    p {
      font-size: 18px;
      opacity: 0.9;
      margin: 0 0 8px;
    }
    .timer {
      font-size: 48px;
      font-weight: 700;
      margin-top: 24px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="spinner"></div>
    <h1>${message}</h1>
    <p>This will take about 10-15 seconds</p>
    <p class="timer" id="timer">15</p>
  </div>
  <script>
    let seconds = 15;
    const timer = document.getElementById('timer');
    setInterval(() => {
      seconds--;
      if (seconds >= 0) {
        timer.textContent = seconds;
      }
    }, 1000);
  </script>
</body>
</html>
  `;
}
```

#### 2. Sleep Controller (–ù–∞ –î—Ä–æ–ø–ª–µ—Ç–∞—Ö)

**–†–æ–ª—å:**
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å (requests, connections)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–º–∏–∫–∞—î –¥—Ä–æ–ø–ª–µ—Ç –ø—ñ—Å–ª—è –ø–µ—Ä—ñ–æ–¥—É –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ
- –ó–±–µ—Ä—ñ–≥–∞—î —Å—Ç–∞–Ω –ø–µ—Ä–µ–¥ –≤–∏–º–∫–Ω–µ–Ω–Ω—è–º

**–í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –Ω–∞ –î—Ä–æ–ø–ª–µ—Ç:**

```bash
# /opt/sleep-controller/monitor.sh

#!/bin/bash

IDLE_TIMEOUT=3600  # 1 –≥–æ–¥–∏–Ω–∞ –±–µ–∑ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ
CHECK_INTERVAL=300 # –ü–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
LAST_ACTIVITY_FILE="/tmp/last_activity"
LOG_FILE="/var/log/sleep-controller.log"

log() {
  echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" | tee -a "$LOG_FILE"
}

get_current_connections() {
  # –†–∞—Ö—É—î–º–æ active connections –¥–æ nginx —Ç–∞ messenger
  nginx_conn=$(netstat -an | grep :80 | grep ESTABLISHED | wc -l)
  messenger_conn=$(netstat -an | grep :8080 | grep ESTABLISHED | wc -l)
  ws_conn=$(netstat -an | grep ESTABLISHED | grep -E ":(8080|443)" | wc -l)

  echo $((nginx_conn + messenger_conn + ws_conn))
}

check_redis_activity() {
  # –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ —î –∞–∫—Ç–∏–≤–Ω—ñ —Å–µ—Å—ñ—ó –≤ Redis
  active_sessions=$(redis-cli KEYS "session:*" | wc -l)
  active_meetings=$(redis-cli KEYS "meeting:*" | wc -l)

  echo $((active_sessions + active_meetings))
}

is_system_active() {
  connections=$(get_current_connections)
  redis_activity=$(check_redis_activity)

  log "Connections: $connections, Redis activity: $redis_activity"

  if [ "$connections" -gt 0 ] || [ "$redis_activity" -gt 0 ]; then
    return 0  # –ê–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å —î
  else
    return 1  # –ù–µ–º–∞—î –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ
  fi
}

update_last_activity() {
  date +%s > "$LAST_ACTIVITY_FILE"
}

get_idle_time() {
  if [ ! -f "$LAST_ACTIVITY_FILE" ]; then
    echo 0
    return
  fi

  last_activity=$(cat "$LAST_ACTIVITY_FILE")
  current_time=$(date +%s)
  echo $((current_time - last_activity))
}

shutdown_droplet() {
  log "üåô Initiating graceful shutdown due to inactivity..."

  # –ó–±–µ—Ä–µ–≥—Ç–∏ Redis snapshot
  redis-cli SAVE
  log "Redis data saved"

  # Graceful shutdown messenger service
  systemctl stop messenger
  log "Messenger service stopped"

  # Flush nginx logs
  systemctl stop nginx
  log "Nginx stopped"

  # Final log
  log "üí§ Going to sleep. Goodbye!"

  # Shutdown —á–µ—Ä–µ–∑ 30 —Å–µ–∫—É–Ω–¥ (—á–∞—Å –Ω–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –ª–æ–≥—ñ–≤)
  shutdown -h +0.5 "Auto-sleep due to inactivity"
}

# Main loop
log "üöÄ Sleep Controller started. Idle timeout: ${IDLE_TIMEOUT}s, Check interval: ${CHECK_INTERVAL}s"
update_last_activity

while true; do
  sleep "$CHECK_INTERVAL"

  if is_system_active; then
    log "‚úÖ System is active"
    update_last_activity
  else
    idle_time=$(get_idle_time)
    log "‚è∞ System idle for ${idle_time}s (threshold: ${IDLE_TIMEOUT}s)"

    if [ "$idle_time" -ge "$IDLE_TIMEOUT" ]; then
      shutdown_droplet
      break
    fi
  fi
done
```

**Systemd Service –¥–ª—è Sleep Controller:**

```bash
# /etc/systemd/system/sleep-controller.service

[Unit]
Description=Droplet Sleep Controller
After=network.target redis.service messenger.service

[Service]
Type=simple
ExecStart=/opt/sleep-controller/monitor.sh
Restart=always
RestartSec=10
StandardOutput=journal
StandardError=journal

[Install]
WantedBy=multi-user.target
```

**–í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è:**

```bash
# –°—Ç–≤–æ—Ä–∏—Ç–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—é
sudo mkdir -p /opt/sleep-controller

# –°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ —Å–∫—Ä–∏–ø—Ç
sudo nano /opt/sleep-controller/monitor.sh
# (–≤—Å—Ç–∞–≤–∏—Ç–∏ –∫–æ–¥ –≤–∏—â–µ)

# –ó—Ä–æ–±–∏—Ç–∏ executable
sudo chmod +x /opt/sleep-controller/monitor.sh

# –°—Ç–≤–æ—Ä–∏—Ç–∏ systemd service
sudo nano /etc/systemd/system/sleep-controller.service
# (–≤—Å—Ç–∞–≤–∏—Ç–∏ –∫–æ–Ω—Ñ—ñ–≥ –≤–∏—â–µ)

# –ê–∫—Ç–∏–≤—É–≤–∞—Ç–∏
sudo systemctl daemon-reload
sudo systemctl enable sleep-controller
sudo systemctl start sleep-controller

# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å
sudo systemctl status sleep-controller
sudo tail -f /var/log/sleep-controller.log
```

#### 3. Health Check Endpoint

–î–æ–¥–∞—Ç–∏ endpoint –¥–ª—è CloudFlare Worker, —â–æ–± –ø–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏ —á–∏ –¥—Ä–æ–ø–ª–µ—Ç –≥–æ—Ç–æ–≤–∏–π:

```go
// –î–æ–¥–∞—Ç–∏ –¥–æ main.go

// Health check endpoint for wake-up verification
http.HandleFunc("/api/health", func(w http.ResponseWriter, r *http.Request) {
    // Check if all services are ready
    redisOK := true
    if err := rdb.Ping(ctx).Err(); err != nil {
        redisOK = false
    }

    sfuOK := sfuServer != nil

    status := "ready"
    if !redisOK || !sfuOK {
        status = "starting"
    }

    response := map[string]interface{}{
        "status": status,
        "redis": redisOK,
        "sfu": sfuOK,
        "uptime": time.Since(startTime).Seconds(),
        "timestamp": time.Now().Unix(),
    }

    w.Header().Set("Content-Type", "application/json")
    json.NewEncoder(w).Encode(response)
})
```

## üìã –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø –û–ü–¢–ò–ú–ê–õ–¨–ù–û–á –ï–ö–û–ù–û–ú–Ü–á

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è 1: –†–æ–∑—Ä–æ–±–∫–∞ (–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –ï–∫–æ–Ω–æ–º—ñ—è)

**–ü–∞—Ä–∞–º–µ—Ç—Ä–∏:**
- –ß–∞—Å –¥–æ –∑–∞—Å–∏–Ω–∞–Ω–Ω—è: **30 —Ö–≤–∏–ª–∏–Ω** –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ
- –ß–∞—Å –ø—Ä–æ–±—É–¥–∂–µ–Ω–Ω—è: **10-15 —Å–µ–∫—É–Ω–¥**
- –û—á—ñ–∫—É–≤–∞–Ω–∏–π uptime: **10% (2.5 –≥–æ–¥/–¥–µ–Ω—å)**

**–ï–∫–æ–Ω–æ–º—ñ—è:** ~$10.80/month (90%)

**–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è:**
```bash
IDLE_TIMEOUT=1800  # 30 —Ö–≤–∏–ª–∏–Ω
CHECK_INTERVAL=300 # –ü–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
```

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è 2: –ê–∫—Ç–∏–≤–Ω–∞ –†–æ–∑—Ä–æ–±–∫–∞

**–ü–∞—Ä–∞–º–µ—Ç—Ä–∏:**
- –ß–∞—Å –¥–æ –∑–∞—Å–∏–Ω–∞–Ω–Ω—è: **1 –≥–æ–¥–∏–Ω–∞** –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ
- –ß–∞—Å –ø—Ä–æ–±—É–¥–∂–µ–Ω–Ω—è: **10-15 —Å–µ–∫—É–Ω–¥**
- –û—á—ñ–∫—É–≤–∞–Ω–∏–π uptime: **20% (5 –≥–æ–¥/–¥–µ–Ω—å)**

**–ï–∫–æ–Ω–æ–º—ñ—è:** ~$9.60/month (80%)

**–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è:**
```bash
IDLE_TIMEOUT=3600  # 1 –≥–æ–¥–∏–Ω–∞
CHECK_INTERVAL=300 # –ü–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
```

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è 3: Demo/Presentation Mode

**–ü–∞—Ä–∞–º–µ—Ç—Ä–∏:**
- –ß–∞—Å –¥–æ –∑–∞—Å–∏–Ω–∞–Ω–Ω—è: **5 —Ö–≤–∏–ª–∏–Ω** –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ
- –ß–∞—Å –ø—Ä–æ–±—É–¥–∂–µ–Ω–Ω—è: **10-15 —Å–µ–∫—É–Ω–¥**
- –û—á—ñ–∫—É–≤–∞–Ω–∏–π uptime: **5% (1 –≥–æ–¥/–¥–µ–Ω—å)**

**–ï–∫–æ–Ω–æ–º—ñ—è:** ~$11.40/month (95%)

**–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è:**
```bash
IDLE_TIMEOUT=300   # 5 —Ö–≤–∏–ª–∏–Ω
CHECK_INTERVAL=60  # –ü–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏ –∫–æ–∂–Ω—É —Ö–≤–∏–ª–∏–Ω—É
```

## üé® UX –û–ü–¢–ò–ú–Ü–ó–ê–¶–Ü–Ø

### –©–æ–± –¶–µ –ë—É–ª–æ –ù–µ–ø–æ–º—ñ—Ç–Ω–æ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º

#### 1. –®–≤–∏–¥–∫–∏–π Wake-Up (10-15 —Å–µ–∫—É–Ω–¥)

**–û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó:**
- ‚úÖ SSD –¥–∏—Å–∫–∏ (–≤–∂–µ —î –Ω–∞ DigitalOcean)
- ‚úÖ –ú—ñ–Ω—ñ–º–∞–ª—å–Ω—ñ systemd services
- ‚úÖ Redis persistence: AOF –≤–∏–º–∫–Ω—É—Ç–∏, —Ç—ñ–ª—å–∫–∏ RDB snapshots
- ‚úÖ Nginx + Go app –≤ systemd –∑ Type=simple

#### 2. –ö—Ä–∞—Å–∏–≤–∏–π Loading Screen

```html
<!-- –ü–æ–∫–∞–∑—É—î CloudFlare Worker -->
üåô Waking up server...
‚è∞ ~15 seconds
üé® Beautiful animation
‚ôªÔ∏è Auto-refresh
```

#### 3. Predictive Wake-Up

**CloudFlare Worker –∑ Machine Learning:**
```javascript
// –Ü—Å—Ç–æ—Ä—ñ—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è
const usagePatterns = await getUsageHistory();

// –ü–µ—Ä–µ–¥–±–∞—á–µ–Ω–Ω—è: —è–∫—â–æ –∑–∞–∑–≤–∏—á–∞–π –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å –æ 9:00-18:00
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –±—É–¥–∏—Ç–∏ –æ 8:55
if (isPredictedUsageTime()) {
  await preWakeUpDroplet();
}
```

#### 4. Keep-Alive –¥–ª—è –ê–∫—Ç–∏–≤–Ω–∏—Ö –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤

**Frontend JavaScript:**
```javascript
// Ping –∫–æ–∂–Ω—ñ 2 —Ö–≤–∏–ª–∏–Ω–∏ –ø—ñ–¥ —á–∞—Å –∞–∫—Ç–∏–≤–Ω–æ—ó —Å–µ—Å—ñ—ó
setInterval(() => {
  if (isUserActive()) {
    fetch('/api/health').then(() => {
      console.log('Keep-alive ping sent');
    });
  }
}, 120000); // 2 —Ö–≤–∏–ª–∏–Ω–∏
```

## üí° –î–û–î–ê–¢–ö–û–í–Ü –°–ü–û–°–û–ë–ò –ï–ö–û–ù–û–ú–Ü–á

### 1. DigitalOcean Snapshots (–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ Sleep)

**–Ø–∫ –ø—Ä–∞—Ü—é—î:**
- –°—Ç–≤–æ—Ä–∏—Ç–∏ snapshot –¥—Ä–æ–ø–ª–µ—Ç–∞ ($0.05/GB/month)
- –í–∏–¥–∞–ª–∏—Ç–∏ –¥—Ä–æ–ø–ª–µ—Ç ($0)
- –ü—Ä–∏ –ø–æ—Ç—Ä–µ–±—ñ - –≤—ñ–¥–Ω–æ–≤–∏—Ç–∏ –∑ snapshot (1-2 —Ö–≤–∏–ª–∏–Ω–∏)

**–ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è:**

| –ú–µ—Ç–æ–¥ | Boot Time | –í–∞—Ä—Ç—ñ—Å—Ç—å | –°–∫–ª–∞–¥–Ω—ñ—Å—Ç—å |
|-------|-----------|----------|------------|
| Power Off/On | 10-15 —Å–µ–∫ | $0.009/hour active | –ù–∏–∑—å–∫–∞ |
| Snapshot + Destroy | 1-2 —Ö–≤ | $0.05/GB/month | –°–µ—Ä–µ–¥–Ω—è |
| Hibernate | 5-10 —Å–µ–∫ | $0.009/hour active | –í–∏—Å–æ–∫–∞ (–Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è) |

**–í–∏—Å–Ω–æ–≤–æ–∫:** Power Off/On –æ–ø—Ç–∏–º–∞–ª—å–Ω–∏–π –¥–ª—è —Ä–æ–∑—Ä–æ–±–∫–∏.

### 2. –û–±'—î–¥–Ω–∞—Ç–∏ –î—Ä–æ–ø–ª–µ—Ç–∏

**–ó–∞—Ä–∞–∑:** 2 –¥—Ä–æ–ø–ª–µ—Ç–∏ √ó $6 = $12/month

**–ü—ñ—Å–ª—è –æ–±'—î–¥–Ω–∞–Ω–Ω—è:** 1 –¥—Ä–æ–ø–ª–µ—Ç √ó $12 = $12/month (–±—ñ–ª—å—à–µ RAM/CPU)

**–ó Sleep —Ä–µ–∂–∏–º–æ–º:** 1 –¥—Ä–æ–ø–ª–µ—Ç √ó 10% uptime = $1.20/month

**–ü–µ—Ä–µ–≤–∞–≥–∏:**
- ‚úÖ –ú–µ–Ω—à–∞ —Å–∫–ª–∞–¥–Ω—ñ—Å—Ç—å —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è
- ‚úÖ –ë—ñ–ª—å—à–µ —Ä–µ—Å—É—Ä—Å—ñ–≤ –¥–ª—è –æ–¥–Ω–æ–≥–æ –¥—Ä–æ–ø–ª–µ—Ç–∞
- ‚úÖ –®–≤–∏–¥—à–∏–π wake-up (—Ç—ñ–ª—å–∫–∏ 1 —Å–µ—Ä–≤–µ—Ä)

### 3. Reserved Instances (–Ø–∫—â–æ –ü–ª–∞–Ω—É—î—à Production)

**–î–ª—è production –ø—ñ—Å–ª—è —Ä–æ–∑—Ä–æ–±–∫–∏:**
- 1 —Ä—ñ–∫ commitment: -20% (–∑ $12 –¥–æ $9.60/month)
- 3 —Ä–æ–∫–∏ commitment: -33% (–∑ $12 –¥–æ $8/month)

**–ê–ª–µ –∑–∞—Ä–∞–∑ NOT —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ** (–ø–æ–∫–∏ —Ä–æ–∑—Ä–æ–±–∫–∞)

## üìä –ü–Ü–î–°–£–ú–ö–û–í–ê –°–¢–†–ê–¢–ï–ì–Ü–Ø

### –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–∞ –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è

```yaml
Environment: Development
Droplets: 2 (messenger + turn)
Sleep Strategy: Power Off after 1 hour idle
Wake Method: CloudFlare Worker + DigitalOcean API
Expected Uptime: 20% (5 hours/day)
Monthly Cost: $2.40 (–±—É–ª–æ $12)
Savings: $9.60/month (80%)
Annual Savings: $115.20
```

### –Ü–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü—ñ—è –ø–æ –ö—Ä–æ–∫–∞—Ö

**–ö—Ä–æ–∫ 1: –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ CloudFlare Worker** ‚è±Ô∏è 30 —Ö–≤
```bash
1. –ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—å –Ω–∞ CloudFlare
2. –î–æ–¥–∞—Ç–∏ –¥–æ–º–µ–Ω messenger.kaminskyi.chat
3. –°—Ç–≤–æ—Ä–∏—Ç–∏ Worker
4. –î–µ–ø–ª–æ—ó—Ç–∏ –∫–æ–¥ (–Ω–∞–≤–µ–¥–µ–Ω–∏–π –≤–∏—â–µ)
5. –ü—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏ –ø—Ä–æ–∫—Å—É–≤–∞–Ω–Ω—è
```

**–ö—Ä–æ–∫ 2: –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ Sleep Controller** ‚è±Ô∏è 20 —Ö–≤
```bash
1. SSH –Ω–∞ –æ–±–∏–¥–≤–∞ –¥—Ä–æ–ø–ª–µ—Ç–∏
2. –°—Ç–≤–æ—Ä–∏—Ç–∏ /opt/sleep-controller/monitor.sh
3. –°—Ç–≤–æ—Ä–∏—Ç–∏ systemd service
4. –ó–∞–ø—É—Å—Ç–∏—Ç–∏ —ñ –ø—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏
```

**–ö—Ä–æ–∫ 3: –î–æ–¥–∞—Ç–∏ Health Check** ‚è±Ô∏è 10 —Ö–≤
```bash
1. –î–æ–¥–∞—Ç–∏ /api/health endpoint –¥–æ main.go
2. –†–µ–∫–æ–º–ø—ñ–ª—é–≤–∞—Ç–∏ —ñ —Ä–µ–¥–µ–ø–ª–æ—ó—Ç–∏
3. –ü—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏ curl https://messenger.kaminskyi.chat/api/health
```

**–ö—Ä–æ–∫ 4: –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è** ‚è±Ô∏è 1 –≥–æ–¥–∏–Ω–∞
```bash
1. –ü–æ—á–µ–∫–∞—Ç–∏ 1 –≥–æ–¥–∏–Ω—É –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ
2. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —â–æ –¥—Ä–æ–ø–ª–µ—Ç –∑–∞—Å–Ω—É–≤
3. –í—ñ–¥–∫—Ä–∏—Ç–∏ messenger.kaminskyi.chat
4. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —â–æ –ø–æ–∫–∞–∑—É—î—Ç—å—Å—è loading screen
5. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —â–æ –¥—Ä–æ–ø–ª–µ—Ç –ø—Ä–æ–∫–∏–Ω—É–≤—Å—è –∑–∞ 15 —Å–µ–∫
6. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —â–æ –≤—Å–µ –ø—Ä–∞—Ü—é—î
```

**–ö—Ä–æ–∫ 5: –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥** ‚è±Ô∏è Continuous
```bash
# –î–∏–≤–∏—Ç–∏—Å—å –ª–æ–≥–∏
ssh root@64.227.116.250 'tail -f /var/log/sleep-controller.log'

# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –≤–∏—Ç—Ä–∞—Ç–∏
# DigitalOcean Dashboard ‚Üí Billing ‚Üí Current Month
```

## üéØ –û–ß–Ü–ö–£–í–ê–ù–Ü –†–ï–ó–£–õ–¨–¢–ê–¢–ò

### –§—ñ–Ω–∞–Ω—Å–æ–≤—ñ

| –ü–µ—Ä—ñ–æ–¥ | –ë–µ–∑ Sleep | –ó Sleep (20% uptime) | –ï–∫–æ–Ω–æ–º—ñ—è |
|--------|-----------|---------------------|----------|
| –î–µ–Ω—å | $0.40 | $0.08 | $0.32 (80%) |
| –¢–∏–∂–¥–µ–Ω—å | $2.80 | $0.56 | $2.24 (80%) |
| –ú—ñ—Å—è—Ü—å | $12.00 | $2.40 | $9.60 (80%) |
| –†—ñ–∫ | $144.00 | $28.80 | $115.20 (80%) |

### User Experience

- **–ü–µ—Ä—à–∏–π –≤—ñ–∑–∏—Ç –ø—ñ—Å–ª—è sleep:** 15 —Å–µ–∫—É–Ω–¥ loading (–ø—Ä–∏–π–Ω—è—Ç–Ω–æ –¥–ª—è —Ä–æ–∑—Ä–æ–±–∫–∏)
- **–ù–∞—Å—Ç—É–ø–Ω—ñ –≤—ñ–∑–∏—Ç–∏ (–ø—Ä–æ—Ç—è–≥–æ–º 1 –≥–æ–¥):** Instant (0 —Å–µ–∫—É–Ω–¥)
- **–ê–∫—Ç–∏–≤–Ω–∞ —Ä–æ–∑—Ä–æ–±–∫–∞:** –ù–µ–ø–æ–º—ñ—Ç–Ω–æ (–¥—Ä–æ–ø–ª–µ—Ç –∑–∞–≤–∂–¥–∏ –∞–∫—Ç–∏–≤–Ω–∏–π)

### –ù–∞–¥—ñ–π–Ω—ñ—Å—Ç—å

- **Uptime:** 99.9% (–∫–æ–ª–∏ –∞–∫—Ç–∏–≤–Ω–∏–π)
- **Data loss:** 0% (Redis snapshots –ø–µ—Ä–µ–¥ sleep)
- **Service degradation:** –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∞ (—Ç—ñ–ª—å–∫–∏ –ø—ñ–¥ —á–∞—Å wake-up)

---

**–ê–≤—Ç–æ—Ä:** Claude AI
**–î–∞—Ç–∞:** 2025-10-07
**–í–µ—Ä—Å—ñ—è:** 1.0
**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤–æ –¥–æ —ñ–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü—ñ—ó
